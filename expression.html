<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CiliaHub Gene Expression in Organs</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #geneSelect { margin-bottom: 20px; padding: 5px; font-size: 16px; }
  #expressionTable { border-collapse: collapse; margin-top: 20px; width: 100%; max-width: 600px; }
  #expressionTable th, #expressionTable td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
  #expressionTable th { background-color: #f0f0f0; }
  .organ { cursor: pointer; transition: fill 0.3s; }
  .tooltip {
    position: absolute;
    background: #fff;
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    pointer-events: none;
    display: none;
    font-size: 14px;
  }
</style>
</head>
<body>

<h2>CiliaHub Gene Expression in Human Organs</h2>

<label for="geneSelect">Select Gene:</label>
<select id="geneSelect"></select>

<div id="svgContainer" style="width: 600px; margin-top: 20px;">
  <!-- SVG will be injected here -->
</div>

<table id="expressionTable">
  <thead>
    <tr>
      <th>Tissue / Organ</th>
      <th>nTPM</th>
      <th>Expression Level</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="tooltip" class="tooltip"></div>

<script>
// --- Configuration ---
const svgFile = 'file.svg';
const jsonFile = 'rna_tissue_consensus.json';

// --- Load SVG ---
fetch(svgFile)
  .then(resp => resp.text())
  .then(svgData => {
    document.getElementById('svgContainer').innerHTML = svgData;
    initApp();
  })
  .catch(err => console.error("Error loading SVG:", err));

// --- Main App ---
function initApp() {
  fetch(jsonFile)
    .then(resp => resp.json())
    .then(data => {
      const geneSelect = document.getElementById('geneSelect');
      const genes = Object.keys(data).sort();

      // Populate dropdown
      genes.forEach(g => {
        const option = document.createElement('option');
        option.value = g;
        option.text = g;
        geneSelect.add(option);
      });

      // Initial plot
      updateGene(genes[0]);

      geneSelect.addEventListener('change', () => updateGene(geneSelect.value));

      function updateGene(gene) {
        const tissueData = data[gene];
        const organs = document.querySelectorAll('.organ');

        // Color scale function
        function getColor(nTPM) {
          if(nTPM <= 5) return '#ccffcc';       // Light green
          if(nTPM <= 15) return '#99ff99';      // Medium green
          if(nTPM <= 30) return '#33cc33';      // Green
          return '#006600';                      // Dark green
        }

        // Update SVG colors
        organs.forEach(o => {
          const tissueName = o.id;
          if(tissueData[tissueName] !== undefined) {
            o.style.fill = getColor(tissueData[tissueName]);
          } else {
            o.style.fill = '#eee'; // No data
          }
        });

        // Update Table
        const tbody = document.querySelector('#expressionTable tbody');
        tbody.innerHTML = '';
        Object.entries(tissueData).forEach(([tissue, value]) => {
          let level = '';
          if(value <= 5) level = 'Low';
          else if(value <= 15) level = 'Medium';
          else if(value <= 30) level = 'High';
          else level = 'Very High';

          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${tissue}</td><td>${value}</td><td>${level}</td>`;
          tbody.appendChild(tr);
        });

        // Tooltip
        const tooltip = document.getElementById('tooltip');
        organs.forEach(o => {
          o.addEventListener('mousemove', e => {
            const tissue = o.id;
            const val = tissueData[tissue] !== undefined ? tissueData[tissue] : 'No data';
            tooltip.style.display = 'block';
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY + 10 + 'px';
            tooltip.innerHTML = `<b>${tissue}</b>: ${val} nTPM`;
          });
          o.addEventListener('mouseleave', () => {
            tooltip.style.display = 'none';
          });
        });
      }
    })
    .catch(err => console.error("Error loading JSON:", err));
}
</script>

</body>
</html>
