<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CiliaHub - Gene Expression</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 20px;
      padding: 0;
      background-color: #f4f4f9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #3373C4;
      color: white;
    }
    input[type="text"] {
      padding: 10px;
      width: 100%;
      border: 1px solid #ccc;
      margin-bottom: 20px;
      font-size: 16px;
    }
    #errorMessage {
      color: red;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h1>Gene Expression Across Tissues</h1>
  <input type="text" id="geneSearch" placeholder="Search for a gene" />
  
  <table>
    <thead>
      <tr>
        <th>Tissue</th>
        <th>Expression</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Data rows will be inserted here -->
    </tbody>
  </table>
  
  <p id="errorMessage"></p>

  <script>
    // Variables for accessing DOM elements
    const elements = {
      searchInput: document.getElementById('geneSearch'),
      tableBody: document.getElementById('tableBody'),
      errorMessage: document.getElementById('errorMessage') // Element for error messages
    };

    // Fetch gene expression data from the provided URL
    const fetchGeneData = async () => {
      try {
        const response = await fetch('https://raw.githubusercontent.com/theCiliaHub/theCiliaHub.github.io/refs/heads/main/rna_tissue_consensus.json');
        if (!response.ok) throw new Error('Failed to fetch gene data');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching gene data:', error);
        return {}; // Return empty object in case of error
      }
    };

    // Function to update the table with gene expression data
    const updateTable = (expressionData) => {
      elements.tableBody.innerHTML = ''; // Clear previous results
      if (Object.keys(expressionData).length === 0) {
        elements.errorMessage.textContent = 'No data found for the selected gene.';
        return;
      }

      // Populate the table with expression data
      for (const tissue in expressionData) {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${tissue}</td><td>${expressionData[tissue]}</td>`;
        elements.tableBody.appendChild(row);
      }
    };

    // Function to handle the search logic
    const handleSearch = async () => {
      const geneName = elements.searchInput.value.trim().toUpperCase(); // Case-insensitive search
      const geneData = await fetchGeneData(); // Fetch gene data

      if (geneName && geneData[geneName]) {
        updateTable(geneData[geneName]); // Update table with gene data
        elements.errorMessage.textContent = ''; // Clear error message
      } else {
        elements.tableBody.innerHTML = ''; // Clear table if no gene found
        elements.errorMessage.textContent = 'Gene not found or no data available for this gene.';
      }
    };

    // Event listener for the search input field
    elements.searchInput.addEventListener('input', handleSearch);
  </script>

</body>
</html>
