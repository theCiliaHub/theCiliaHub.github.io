<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CiliaHub: A Database of Genes with Ciliary Functions</title>
    <meta name="description" content="CiliaHub is a comprehensive bioinformatics database for genes with ciliary functions.">
    <meta name="keywords" content="CiliaHub, bioinformatics, ciliary genes, gene database, scientific research">
    <meta property="og:title" content="CiliaHub: A Database of Genes with Ciliary Functions">
    <meta property="og:description" content="Explore genes with ciliary functions using CiliaHub's interactive tools.">
    <meta property="og:image" content="CiliaHub_Logo_web.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/png" href="CiliaHub_Logo_web.png">

    <!-- External Libraries (Deferred for performance) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <script defer src="https://unpkg.com/@upsetjs/bundle"></script>
    <script defer src="https://d3js.org/d3.v7.min.js"></script>
    <script defer src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
    <script defer src="plots.js"></script>
    <script defer src="script.js"></script>
    <script defer src="globals.js"></script>

    <style>
        :root {
            --primary-blue: #2c5aa0;
            --primary-blue-light: #4a89dc;
            --primary-blue-dark: #1e3f73;
            --accent-blue: #3498db;
            --light-blue: #e8f4fd;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #6c757d;
            --text-dark: #333333;
            --text-light: #ffffff;
            --success-green: #28a745;
            --warning-orange: #ffc107;
            --error-red: #dc3545;
            --border-color: #dee2e6;
            --shadow-light: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-strong: 0 8px 15px rgba(0,0,0,0.1);
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: var(--white);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .navbar {
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-blue-light));
            color: var(--text-light);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-strong);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 800;
            text-decoration: none;
            color: var(--text-light);
            letter-spacing: 1px;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 1rem;
            margin: 0;
            padding: 0;
        }

        .nav-links li a {
            color: var(--text-light);
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.8rem 1.2rem;
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
        }

        .nav-links li a:hover,
        .nav-links li a:focus-visible,
        .nav-links li a.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            outline: none;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
        }

        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 2rem;
            min-height: calc(100vh - 120px);
        }

        .content-area {
            flex: 1;
            background: var(--white);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-color);
            min-height: 600px;
        }

        .cilia-panel {
            width: 320px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-medium);
            position: sticky;
            top: 120px;
            height: fit-content;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .panel-header {
            background: var(--light-blue);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .panel-header h3 {
            color: var(--primary-blue);
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
            text-align: center;
        }

        .panel-content {
            padding: var(--spacing-md);
        }

        .cilia-container {
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .interactive-cilium svg {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-sm);
            background: var(--light-gray);
            padding: var(--spacing-sm);
        }

        .cilia-part, .ciliaplot-part {
            cursor: pointer;
            transition: all 0.3s ease;
            stroke-width: 2;
            stroke: #dee2e6;
        }

        .cilia-part:hover, .ciliaplot-part:hover {
            filter: brightness(1.1);
            stroke: var(--primary-blue);
            stroke-width: 3;
        }

        .cilia-part:focus, .ciliaplot-part:focus {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .cilia-part.highlighted, .ciliaplot-part.highlighted {
            stroke: var(--error-red);
            stroke-width: 3;
            filter: brightness(1.2);
        }

        .cilia-count {
            font-size: 12px;
            fill: var(--text-dark);
            font-weight: 500;
            pointer-events: none;
        }

        .controls h4 {
            color: var(--primary-blue);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            text-align: center;
        }

        .gene-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .gene-btn {
            padding: 0.8rem;
            background: var(--light-gray);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-dark);
            transition: all 0.3s ease;
            text-align: left;
        }

        .gene-btn:hover,
        .gene-btn:focus-visible,
        .gene-btn.search-gene {
            background: var(--primary-blue);
            color: var(--text-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
            outline: none;
        }

        .gene-btn.default {
            background: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }

        .gene-btn.default:hover {
            background: var(--primary-blue);
            color: var(--text-light);
        }

        .gene-btn.reset-btn {
            background: var(--medium-gray);
            color: var(--text-dark);
            margin-top: var(--spacing-sm);
        }

        .gene-btn.reset-btn:hover {
            background: var(--dark-gray);
            color: var(--text-light);
        }

        h1 {
            color: var(--primary-blue);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }

        h2 {
            color: var(--primary-blue);
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        h3 {
            color: var(--primary-blue-dark);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .search-container {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            position: relative;
            background: var(--light-blue);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .search-container.sticky {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1000px;
            background: var(--white);
            box-shadow: var(--shadow-strong);
            z-index: 999;
        }

        .search-wrapper {
            position: relative;
            flex: 1;
        }

        .search-wrapper input, .search-wrapper textarea, .search-wrapper select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1.1rem;
            background: var(--white);
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .search-wrapper input:focus, .search-wrapper textarea:focus, .search-wrapper select:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .search-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--primary-blue);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover,
        .search-btn:focus-visible {
            background: var(--primary-blue-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            outline: none;
        }

        .btn {
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: var(--text-light);
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .btn-primary:hover,
        .btn-primary:focus-visible {
            background: var(--primary-blue-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            outline: none;
        }

        .btn-secondary {
            background: var(--light-gray);
            color: var(--text-dark);
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover,
        .btn-secondary:focus-visible {
            background: var(--medium-gray);
            outline: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-sm);
            background: var(--white);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }

        th, td {
            padding: var(--spacing-sm) var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-blue);
            color: var(--text-light);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:nth-child(even) {
            background: var(--light-gray);
        }

        tr:hover {
            background: var(--light-blue);
            transition: background 0.3s ease;
        }

        td a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }

        td a:hover,
        td a:focus-visible {
            color: var(--primary-blue-dark);
            text-decoration: underline;
            outline: none;
        }

        .gene-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .gene-card {
            background: var(--white);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-light);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .gene-card:hover,
        .gene-card:focus-visible {
            transform: translateY(-4px);
            box-shadow: var(--shadow-strong);
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .gene-card.search-result {
            background: var(--light-blue);
            border-color: var(--primary-blue);
        }

        .gene-card.default {
            background: var(--light-blue);
            border-color: var(--primary-blue);
        }

        .gene-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: var(--spacing-xs);
        }

        .gene-description {
            font-size: 0.95rem;
            color: var(--text-dark);
            margin-bottom: var(--spacing-xs);
            line-height: 1.5;
        }

        .gene-info {
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
            color: var(--dark-gray);
        }

        .gene-info strong {
            color: var(--primary-blue);
        }

        .card {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-light);
            margin-bottom: var(--spacing-md);
        }

        input, select, textarea {
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            color: var(--text-dark);
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .tooltip {
            position: absolute;
            background: var(--text-dark);
            color: var(--text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 1000;
            box-shadow: var(--shadow-medium);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
        }

        .pagination button {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--primary-blue);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: var(--primary-blue-dark);
        }

        .pagination button:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm);
            background: var(--light-gray);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .status-message {
            text-align: center;
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            margin: var(--spacing-md) 0;
        }

        .success-message {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-green);
            border: 1px solid var(--success-green);
        }

        .error-message {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error-red);
            border: 1px solid var(--error-red);
        }

        .warning-message {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-orange);
            border: 1px solid var(--warning-orange);
        }

        .ciliaplot-container {
            background: var(--light-blue);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .plot-container {
            min-height: 400px;
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm);
            position: relative;
        }

        .footer {
            background: var(--light-gray);
            color: var(--dark-gray);
            padding: var(--spacing-md);
            text-align: center;
            border-top: 1px solid var(--border-color);
            margin-top: var(--spacing-xl);
        }

        .footer a {
            color: var(--primary-blue);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .footer .version-info {
            margin-top: var(--spacing-xs);
            font-size: 0.9rem;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                padding: var(--spacing-md);
            }

            .cilia-panel {
                position: static;
                width: 100%;
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: var(--spacing-sm) 0;
            }

            .nav-container {
                flex-direction: column;
                gap: var(--spacing-sm);
                padding: 0 var(--spacing-sm);
            }

            .logo {
                font-size: 1.8rem;
            }

            .hamburger {
                display: block;
            }

            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                text-align: center;
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links li a {
                font-size: 1rem;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .main-container {
                padding: var(--spacing-sm);
            }

            .gene-cards {
                grid-template-columns: 1fr;
            }

            .search-container {
                flex-direction: column;
            }

            .search-container.sticky {
                position: static;
                transform: none;
                width: 100%;
            }
        }

        *:focus-visible {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        html {
            scroll-behavior: smooth;
        }

        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(44, 90, 160, 0.1), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="#/" onclick="navigateTo(event, '/')" class="logo">CiliaHub</a>
            <button class="hamburger" aria-label="Toggle navigation">☰</button>
            <ul class="nav-links">
                <li><a href="#/" onclick="navigateTo(event, '/')" aria-label="Home" class="active">Home</a></li>
                <li><a href="#/ciliaplot" onclick="navigateTo(event, '/ciliaplot')" aria-label="CiliaPlot">CiliaPlot</a></li>
                <li><a href="#/batch-query" onclick="navigateTo(event, '/batch-query')" aria-label="Batch Query">Batch Query</a></li>
                <li><a href="#/compare" onclick="navigateTo(event, '/compare')" aria-label="Compare">Compare</a></li>
                <li><a href="#/expression" onclick="navigateTo(event, '/expression')" aria-label="Expression">Expression</a></li>
                <li><a href="#/download" onclick="navigateTo(event, '/download')" aria-label="Download">Download</a></li>
                <li><a href="#/contact" onclick="navigateTo(event, '/contact')" aria-label="Contact">Contact</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-container">
        <div class="content-area" id="content-area">
            <div id="home" class="page-content">
                <h1>Welcome to CiliaHub</h1>
                <p>CiliaHub is a comprehensive database for genes with ciliary functions, offering interactive tools for visualization, querying, and comparison.</p>
                <div class="search-container">
                    <div class="search-wrapper">
                        <input type="text" placeholder="Search genes..." aria-label="Search genes">
                    </div>
                    <button class="search-btn">Search</button>
                </div>
                <div class="gene-cards">
                    <div class="gene-card">
                        <div class="gene-name">IFT88</div>
                        <div class="gene-description">Intraflagellar transport protein 88, essential for ciliary assembly.</div>
                        <div class="gene-info"><strong>Localization:</strong> Axoneme</div>
                    </div>
                    <div class="gene-card">
                        <div class="gene-name">BBS1</div>
                        <div class="gene-description">Bardet-Biedl syndrome 1 protein, involved in ciliary function.</div>
                        <div class="gene-info"><strong>Localization:</strong> Basal Body</div>
                    </div>
                </div>
            </div>

            <div id="ciliaplot" class="page-content" style="display: none;">
                <h1>CiliaPlot</h1>
                <p>Interactive workspace for visualizing gene expression and ciliary data.</p>
                <div class="ciliaplot-container">
                    <div class="search-container">
                        <div class="search-wrapper">
                            <input type="text" placeholder="Search genes..." aria-label="Search genes">
                        </div>
                        <button class="search-btn">Search</button>
                    </div>
                    <div class="filters">
                        <select id="plot-type" aria-label="Select plot type">
                            <option value="chartjs-bar">Chart.js Bar</option>
                            <option value="chartjs-line">Chart.js Line</option>
                            <option value="chartjs-scatter">Chart.js Scatter</option>
                            <option value="plotly">Plotly</option>
                            <option value="d3">D3</option>
                            <option value="upset">UpSet.js</option>
                        </select>
                        <select id="data-type" aria-label="Select data type">
                            <option value="expression">Expression Level</option>
                            <option value="localization">Localization Score</option>
                        </select>
                        <button class="btn-primary" onclick="updateCiliaPlot()">Update Plot</button>
                    </div>
                    <div class="plot-container" id="ciliaplot-container">
                        <canvas id="ciliaplot-chart" style="display: none;"></canvas>
                        <div id="ciliaplot-plotly" style="display: none;"></div>
                        <div id="ciliaplot-d3" style="display: none;"></div>
                        <div id="ciliaplot-upset" style="display: none;"></div>
                        <div class="error-message" id="plot-error" style="display: none;">Failed to load plot. Please check your network connection.</div>
                    </div>
                    <div class="filters">
                        <button class="btn-primary" onclick="downloadPlotAsPNG()">Download Plot (PNG)</button>
                        <button class="btn-secondary" onclick="downloadData('csv')">Download Data (CSV)</button>
                        <button class="btn-secondary" onclick="downloadData('json')">Download Data (JSON)</button>
                    </div>
                </div>
            </div>

            <div id="batch-query" class="page-content" style="display: none;">
                <h1>Batch Query</h1>
                <p>Paste a list of genes and filter by localization to query the database.</p>
                <div class="search-container">
                    <div class="search-wrapper">
                        <textarea placeholder="Paste gene list (one per line)" aria-label="Gene list"></textarea>
                    </div>
                    <div class="search-wrapper">
                        <select name="localization" aria-label="Select localization">
                            <option value="">Select Localization</option>
                            <option value="axoneme">Axoneme</option>
                            <option value="basal-body">Basal Body</option>
                            <option value="transition-zone">Transition Zone</option>
                        </select>
                    </div>
                    <button class="search-btn">Query</button>
                </div>
                <div class="card">
                    <h3>Results</h3>
                    <table>
                        <thead>
                            <tr><th>Gene</th><th>Localization</th><th>Expression</th></tr>
                        </thead>
                        <tbody id="batch-results"></tbody>
                    </table>
                </div>
            </div>

            <div id="compare" class="page-content" style="display: none;">
                <h1>Compare Genes</h1>
                <p>Select up to 10 genes to compare their properties side-by-side.</p>
                <div class="search-container">
                    <div class="search-wrapper">
                        <input type="text" placeholder="Search genes to compare..." aria-label="Search genes to compare">
                    </div>
                    <button class="search-btn">Add Gene</button>
                </div>
                <div class="warning-message" id="compare-warning" style="display: none;">Maximum 10 genes allowed for comparison.</div>
                <div class="gene-cards" id="compare-genes"></div>
            </div>

            <div id="expression" class="page-content" style="display: none;">
                <h1>Expression Data</h1>
                <p>Explore gene expression profiles across different conditions.</p>
                <div class="card">
                    <h3>Expression Profiles</h3>
                    <div class="plot-container" id="expression-plot"></div>
                </div>
            </div>

            <div id="download" class="page-content" style="display: none;">
                <h1>Download Data</h1>
                <p>Download gene data in CSV or JSON format.</p>
                <div class="filters">
                    <select name="format" aria-label="Select download format">
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                    </select>
                    <button class="btn-primary">Download</button>
                </div>
                <div class="card">
                    <h3>Data Preview</h3>
                    <table>
                        <thead>
                            <tr><th>Gene</th><th>Localization</th><th>Expression</th></tr>
                        </thead>
                        <tbody id="download-preview"></tbody>
                    </table>
                </div>
            </div>

            <div id="contact" class="page-content" style="display: none;">
                <h1>Contact Us</h1>
                <p>Reach out to us for support or to report issues.</p>
                <div class="card">
                    <h3>Contact Information</h3>
                    <p><strong>Email:</strong> <a href="mailto:contact@ciliahub.org">contact@ciliahub.org</a></p>
                    <p><strong>GitHub:</strong> <a href="https://github.com/ciliahub/ciliahub.github.io/issues" target="_blank" rel="noopener noreferrer">Submit an Issue</a></p>
                </div>
                <div class="card">
                    <h3>Cite CiliaHub</h3>
                    <p>Please cite the following paper when using CiliaHub data in your research:</p>
                    <p>Ferhan Yenisert &amp; Oktay I. Kaplan, <strong>“Expanded Catalog of Gold Standard Ciliary Gene List. Integration of Novel Ciliary Genes into the Ciliome,”</strong> bioRxiv preprint: <a href="https://www.biorxiv.org/content/10.1101/2025.08.22.671678v1" target="_blank" rel="noopener noreferrer" aria-label="Open bioRxiv preprint in a new tab">https://www.biorxiv.org/content/10.1101/2025.08.22.671678v1</a></p>
                </div>
            </div>
        </div>

        <aside class="cilia-panel">
            <div class="panel-header">
                <h3>Interactive Cilium</h3>
            </div>
            <div class="panel-content">
                <div class="cilia-container interactive-cilium">
                    <svg viewBox="0 0 300 400" xmlns="http://www.w3.org/2000/svg">
                        <title id="cell-body-label">Cell body of cilium</title>
                        <path id="cell-body" class="cilia-part" tabindex="0" fill="none" stroke="#dee2e6" d="M 50,380 C -20,300 20,200 150,200 C 280,200 320,300 250,380 Z" aria-labelledby="cell-body-label"/>
                        <text x="150" y="380" class="cilia-count" text-anchor="middle">300 genes</text>
                        <title id="nucleus-label">Nucleus of cell</title>
                        <circle id="nucleus" class="cilia-part" tabindex="0" fill="#A7C7E7" cx="150" cy="320" r="40" aria-labelledby="nucleus-label"/>
                        <text x="150" y="320" class="cilia-count" text-anchor="middle">200 genes</text>
                        <title id="basal-body-label">Basal body of cilium</title>
                        <rect id="basal-body" class="cilia-part" tabindex="0" fill="#2F2F2F" x="140" y="195" width="20" height="15" aria-labelledby="basal-body-label"/>
                        <text x="150" y="205" class="cilia-count" text-anchor="middle">250 genes</text>
                        <title id="transition-zone-label">Transition zone of cilium</title>
                        <path id="transition-zone" class="ciliaplot-part" tabindex="0" fill="#9B59B6" d="M 142,195 L 138,180 L 162,180 L 158,195 Z" aria-labelledby="transition-zone-label"/>
                        <text x="150" y="187" class="cilia-count" text-anchor="middle">150 genes</text>
                        <title id="ciliary-membrane-label">Ciliary membrane</title>
                        <path id="ciliary-membrane" class="cilia-part" tabindex="0" fill="none" fill-opacity="0.5" stroke="#3498db" stroke-width="3" d="M 138,180 L 145,10 L 155,10 L 162,180 Z" aria-labelledby="ciliary-membrane-label"/>
                        <text x="150" y="100" class="cilia-count" text-anchor="middle">200 genes</text>
                        <title id="axoneme-label">Axoneme of cilium</title>
                        <path id="axoneme" class="cilia-part" tabindex="0" fill="none" stroke="#2c5aa0" stroke-width="2" d="M 145,180 L 148,15 L 152,15 L 155,180 Z" aria-labelledby="axoneme-label"/>
                        <text x="150" y="50" class="cilia-count" text-anchor="middle">334 genes</text>
                    </svg>
                </div>
                <div class="controls">
                    <h4>Gene Localization:</h4>
                    <div id="geneButtons" class="gene-buttons">
                        <button class="gene-btn default" data-gene="IFT88">IFT88</button>
                        <button class="gene-btn" data-gene="BBS1">BBS1</button>
                        <button class="gene-btn" data-gene="DYNC2H1">DYNC2H1</button>
                        <button class="gene-btn reset-btn">Reset</button>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <div id="enrichment-tooltip" class="tooltip"></div>
    <div id="multi-dim-tooltip" class="tooltip"></div>

    <footer class="footer">
        <p>© 2025 CiliaHub. All rights reserved. | <a href="mailto:contact@ciliahub.org">Contact</a> | <a href="https://github.com/ciliahub/ciliahub.github.io">GitHub</a></p>
        <p class="version-info">CiliaHub Version 1.0.0, 1234 ciliary genes in database</p>
    </footer>

    <script>
        let currentChart = null;
        let currentPlotly = null;
        let currentD3 = null;
        let currentUpSet = null;

        function initCiliaPlot() {
            const plotType = document.getElementById('plot-type')?.value || 'chartjs-bar';
            const dataType = document.getElementById('data-type')?.value || 'expression';
            const errorDiv = document.getElementById('plot-error');
            const containers = {
                chartjs: document.getElementById('ciliaplot-chart'),
                plotly: document.getElementById('ciliaplot-plotly'),
                d3: document.getElementById('ciliaplot-d3'),
                upset: document.getElementById('ciliaplot-upset')
            };

            Object.values(containers).forEach(container => container.style.display = 'none');
            errorDiv.style.display = 'none';

            const sampleData = {
                genes: ['IFT88', 'BBS1', 'DYNC2H1'],
                values: dataType === 'expression' ? [10, 15, 12] : [0.8, 0.6, 0.9],
                sets: [
                    { name: 'IFT88', sets: ['Axoneme', 'Transition Zone'] },
                    { name: 'BBS1', sets: ['Basal Body'] },
                    { name: 'DYNC2H1', sets: ['Axoneme'] }
                ]
            };

            try {
                if (plotType.startsWith('chartjs-')) {
                    if (!window.Chart) throw new Error('Chart.js not loaded');
                    containers.chartjs.style.display = 'block';
                    if (currentChart) currentChart.destroy();
                    const ctx = containers.chartjs.getContext('2d');
                    const chartType = plotType.split('-')[1];
                    currentChart = new Chart(ctx, {
                        type: chartType,
                        data: {
                            labels: sampleData.genes,
                            datasets: [{
                                label: dataType === 'expression' ? 'Expression Level' : 'Localization Score',
                                data: sampleData.values,
                                backgroundColor: ['#2c5aa0', '#4a89dc', '#2ab7ca'],
                                borderColor: ['#1e3f73', '#2c5aa0', '#1e8e9d'],
                                borderWidth: 1,
                                fill: chartType === 'line' || chartType === 'scatter'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: dataType === 'expression' ? 'Expression Level' : 'Localization Score' } }
                            },
                            plugins: {
                                datalabels: { display: true, color: '#333' }
                            }
                        }
                    });
                } else if (plotType === 'plotly') {
                    if (!window.Plotly) throw new Error('Plotly not loaded');
                    containers.plotly.style.display = 'block';
                    if (currentPlotly) Plotly.purge(containers.plotly);
                    Plotly.newPlot(containers.plotly, [{
                        x: sampleData.genes,
                        y: sampleData.values,
                        type: 'bar',
                        marker: { color: ['#2c5aa0', '#4a89dc', '#2ab7ca'] }
                    }], {
                        title: dataType === 'expression' ? 'Expression Level' : 'Localization Score',
                        xaxis: { title: 'Genes' },
                        yaxis: { title: dataType === 'expression' ? 'Expression Level' : 'Localization Score' }
                    });
                    currentPlotly = containers.plotly;
                } else if (plotType === 'd3') {
                    if (!window.d3) throw new Error('D3 not loaded');
                    containers.d3.style.display = 'block';
                    d3.select(containers.d3).selectAll('*').remove();
                    const svg = d3.select(containers.d3)
                        .append('svg')
                        .attr('width', 400)
                        .attr('height', 300);
                    const margin = { top: 20, right: 20, bottom: 50, left: 50 };
                    const width = 400 - margin.left - margin.right;
                    const height = 300 - margin.top - margin.bottom;
                    const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
                    const x = d3.scaleBand().domain(sampleData.genes).range([0, width]).padding(0.1);
                    const y = d3.scaleLinear().domain([0, Math.max(...sampleData.values)]).range([height, 0]);
                    g.selectAll('.bar')
                        .data(sampleData.values)
                        .enter()
                        .append('rect')
                        .attr('class', 'bar')
                        .attr('x', (d, i) => x(sampleData.genes[i]))
                        .attr('y', d => y(d))
                        .attr('width', x.bandwidth())
                        .attr('height', d => height - y(d))
                        .attr('fill', (d, i) => ['#2c5aa0', '#4a89dc', '#2ab7ca'][i]);
                    g.append('g')
                        .attr('transform', `translate(0,${height})`)
                        .call(d3.axisBottom(x));
                    g.append('g')
                        .call(d3.axisLeft(y));
                    currentD3 = svg;
                } else if (plotType === 'upset') {
                    if (!window.UpSetJS) throw new Error('UpSet.js not loaded');
                    containers.upset.style.display = 'block';
                    d3.select(containers.upset).selectAll('*').remove();
                    UpSetJS.renderUpSet(containers.upset, sampleData.sets, {
                        width: 400,
                        height: 300,
                        theme: 'light'
                    });
                    currentUpSet = containers.upset;
                }
            } catch (err) {
                errorDiv.style.display = 'block';
                errorDiv.textContent = `Failed to load plot: ${err.message}`;
            }
        }

        function updateCiliaPlot() {
            initCiliaPlot();
        }

        function downloadPlotAsPNG() {
            const plotType = document.getElementById('plot-type')?.value;
            const container = document.getElementById('ciliaplot-container');
            if (!container) return alert('No plot available to download.');

            html2canvas(container).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                pdf.addImage(imgData, 'PNG', 10, 10, 190, 100);
                pdf.save('ciliaplot.png');
            }).catch(err => {
                alert('Failed to download plot: ' + err.message);
            });
        }

        function downloadData(format) {
            const data = [
                { gene: 'IFT88', localization: 'Axoneme', expression: 10 },
                { gene: 'BBS1', localization: 'Basal Body', expression: 15 },
                { gene: 'DYNC2H1', localization: 'Axoneme', expression: 12 }
            ];
            if (format === 'csv') {
                const csv = 'Gene,Localization,Expression\n' + data.map(row => `${row.gene},${row.localization},${row.expression}`).join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ciliaplot-data.csv';
                a.click();
                URL.revokeObjectURL(url);
            } else {
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ciliaplot-data.json';
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        function navigateTo(event, path) {
            event.preventDefault();
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.style.display = 'none');
            const targetPage = document.getElementById(path.slice(1) || 'home');
            targetPage.style.display = 'block';

            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${path}`) {
                    link.classList.add('active');
                }
            });

            if (path === '/ciliaplot') {
                initCiliaPlot();
            }

            document.querySelector('.nav-links').classList.remove('active');
        }

        document.querySelector('.hamburger').addEventListener('click', () => {
            document.querySelector('.nav-links').classList.toggle('active');
        });

        document.getElementById('geneButtons').addEventListener('click', (e) => {
            if (e.target.classList.contains('gene-btn') && !e.target.classList.contains('reset-btn')) {
                const gene = e.target.dataset.gene;
                const partMap = {
                    'IFT88': 'axoneme',
                    'BBS1': 'basal-body',
                    'DYNC2H1': 'axoneme'
                };
                const partId = partMap[gene];
                if (partId) {
                    document.querySelectorAll('.cilia-part, .ciliaplot-part').forEach(part => {
                        part.classList.toggle('highlighted', part.id === partId);
                    });
                    document.querySelectorAll('.gene-btn').forEach(btn => {
                        btn.classList.toggle('search-gene', btn.dataset.gene === gene);
                    });
                }
            } else if (e.target.classList.contains('reset-btn')) {
                document.querySelectorAll('.gene-btn').forEach(btn => btn.classList.remove('search-gene'));
                document.querySelectorAll('.cilia-part, .ciliaplot-part').forEach(part => part.classList.remove('highlighted'));
            }
        });

        document.querySelectorAll('.cilia-part, .ciliaplot-part').forEach(part => {
            part.addEventListener('click', () => {
                const tooltip = document.getElementById('enrichment-tooltip');
                tooltip.textContent = `Component: ${part.getAttribute('aria-labelledby').replace('-label', '')}, Genes: ${part.nextElementSibling?.textContent || 'Unknown'}`;
                tooltip.style.left = `${part.getBoundingClientRect().left + 10}px`;
                tooltip.style.top = `${part.getBoundingClientRect().top - 30}px`;
                tooltip.classList.add('visible');
                setTimeout(() => tooltip.classList.remove('visible'), 2000);
            });
        });

        document.querySelector('#home .search-btn')?.addEventListener('click', () => {
            const input = document.querySelector('#home input').value;
            if (input) alert(`Searching for: ${input}`);
        });

        document.querySelector('#compare .search-btn')?.addEventListener('click', () => {
            const geneCards = document.querySelectorAll('#compare-genes .gene-card');
            if (geneCards.length >= 10) {
                document.getElementById('compare-warning').style.display = 'block';
                return;
            }
            const input = document.querySelector('#compare input').value;
            if (input) {
                const card = document.createElement('div');
                card.className = 'gene-card';
                card.innerHTML = `
                    <div class="gene-name">${input}</div>
                    <div class="gene-description">Sample gene description.</div>
                    <div class="gene-info"><strong>Localization:</strong> Unknown</div>
                `;
                document.getElementById('compare-genes').appendChild(card);
                document.querySelector('#compare input').value = '';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.hash === '#/ciliaplot') {
                initCiliaPlot();
            }
        });
    </script>
</body>
</html>
